var teams = [
  {
    "Title": "Russia",
    "AvgMarketValuePerPlayer": 5800000,
    "WinsAgainstTopOpponentSince2014": 1,
    "GamesAgainstTopOpponentSince2014": 9,
    "AmountTopPlayers": 0,
    "FifaWorldRank": 70
  },
  {
    "Title": "Saudi Arabia",
    "AvgMarketValuePerPlayer": 800000,
    "WinsAgainstTopOpponentSince2014": 0,
    "GamesAgainstTopOpponentSince2014": 3,
    "AmountTopPlayers": 0,
    "FifaWorldRank": 67
  },
  {
    "Title": "Egypt",
    "AvgMarketValuePerPlayer": 8400000,
    "WinsAgainstTopOpponentSince2014": 0,
    "GamesAgainstTopOpponentSince2014": 2,
    "AmountTopPlayers": 2,
    "FifaWorldRank": 45
  },
  {
    "Title": "Uruguay",
    "AvgMarketValuePerPlayer": 15800000,
    "WinsAgainstTopOpponentSince2014": 1,
    "GamesAgainstTopOpponentSince2014": 7,
    "AmountTopPlayers": 3,
    "FifaWorldRank": 14
  },
  {
    "Title": "Portugal",
    "AvgMarketValuePerPlayer": 20200000,
    "WinsAgainstTopOpponentSince2014": 3,
    "GamesAgainstTopOpponentSince2014": 7,
    "AmountTopPlayers": 2,
    "FifaWorldRank": 4
  },
  {
    "Title": "Spain",
    "AvgMarketValuePerPlayer": 45000000,
    "WinsAgainstTopOpponentSince2014": 4,
    "GamesAgainstTopOpponentSince2014": 9,
    "AmountTopPlayers": 15,
    "FifaWorldRank": 10
  },
  {
    "Title": "Morocco",
    "AvgMarketValuePerPlayer": 5100000,
    "WinsAgainstTopOpponentSince2014": 0,
    "GamesAgainstTopOpponentSince2014": 1,
    "AmountTopPlayers": 2,
    "FifaWorldRank": 41
  },
  {
    "Title": "Iran",
    "AvgMarketValuePerPlayer": 1700000,
    "WinsAgainstTopOpponentSince2014": 0,
    "GamesAgainstTopOpponentSince2014": 0,
    "AmountTopPlayers": 0,
    "FifaWorldRank": 37
  },
  {
    "Title": "France",
    "AvgMarketValuePerPlayer": 44800000,
    "WinsAgainstTopOpponentSince2014": 6,
    "GamesAgainstTopOpponentSince2014": 13,
    "AmountTopPlayers": 12,
    "FifaWorldRank": 7
  },
  {
    "Title": "Australia",
    "AvgMarketValuePerPlayer": 2000000,
    "WinsAgainstTopOpponentSince2014": 0,
    "GamesAgainstTopOpponentSince2014": 6,
    "AmountTopPlayers": 0,
    "FifaWorldRank": 36
  },
  {
    "Title": "Peru",
    "AvgMarketValuePerPlayer": 1500000,
    "WinsAgainstTopOpponentSince2014": 2,
    "GamesAgainstTopOpponentSince2014": 13,
    "AmountTopPlayers": 0,
    "FifaWorldRank": 11
  },
  {
    "Title": "Denmark",
    "AvgMarketValuePerPlayer": 11000000,
    "WinsAgainstTopOpponentSince2014": 0,
    "GamesAgainstTopOpponentSince2014": 5,
    "AmountTopPlayers": 1,
    "FifaWorldRank": 12
  },
  {
    "Title": "Argentina",
    "AvgMarketValuePerPlayer": 30300000,
    "WinsAgainstTopOpponentSince2014": 7,
    "GamesAgainstTopOpponentSince2014": 13,
    "AmountTopPlayers": 9,
    "FifaWorldRank": 5
  },
  {
    "Title": "Iceland",
    "AvgMarketValuePerPlayer": 3100000,
    "WinsAgainstTopOpponentSince2014": 1,
    "GamesAgainstTopOpponentSince2014": 4,
    "AmountTopPlayers": 0,
    "FifaWorldRank": 22
  },
  {
    "Title": "Croatia",
    "AvgMarketValuePerPlayer": 14700000,
    "WinsAgainstTopOpponentSince2014": 1,
    "GamesAgainstTopOpponentSince2014": 4,
    "AmountTopPlayers": 5,
    "FifaWorldRank": 20
  },
  {
    "Title": "Nigeria",
    "AvgMarketValuePerPlayer": 5500000,
    "WinsAgainstTopOpponentSince2014": 1,
    "GamesAgainstTopOpponentSince2014": 2,
    "AmountTopPlayers": 2,
    "FifaWorldRank": 48
  },
  {
    "Title": "Brazil",
    "AvgMarketValuePerPlayer": 41300000,
    "WinsAgainstTopOpponentSince2014": 8,
    "GamesAgainstTopOpponentSince2014": 14,
    "AmountTopPlayers": 14,
    "FifaWorldRank": 2
  },
  {
    "Title": "Switzerland",
    "AvgMarketValuePerPlayer": 9100000,
    "WinsAgainstTopOpponentSince2014": 1,
    "GamesAgainstTopOpponentSince2014": 7,
    "AmountTopPlayers": 2,
    "FifaWorldRank": 6
  },
  {
    "Title": "Costa Rica",
    "AvgMarketValuePerPlayer": 1800000,
    "WinsAgainstTopOpponentSince2014": 3,
    "GamesAgainstTopOpponentSince2014": 7,
    "AmountTopPlayers": 1,
    "FifaWorldRank": 23
  },
  {
    "Title": "Serbia",
    "AvgMarketValuePerPlayer": 10400000,
    "WinsAgainstTopOpponentSince2014": 0,
    "GamesAgainstTopOpponentSince2014": 4,
    "AmountTopPlayers": 2,
    "FifaWorldRank": 34
  },
  {
    "Title": "Germany",
    "AvgMarketValuePerPlayer": 38100000,
    "WinsAgainstTopOpponentSince2014": 2,
    "GamesAgainstTopOpponentSince2014": 10,
    "AmountTopPlayers": 15,
    "FifaWorldRank": 1
  },
  {
    "Title": "Mexico",
    "AvgMarketValuePerPlayer": 6000000,
    "WinsAgainstTopOpponentSince2014": 1,
    "GamesAgainstTopOpponentSince2014": 7,
    "AmountTopPlayers": 0,
    "FifaWorldRank": 15
  },
  {
    "Title": "Sweden",
    "AvgMarketValuePerPlayer": 4900000,
    "WinsAgainstTopOpponentSince2014": 2,
    "GamesAgainstTopOpponentSince2014": 5,
    "AmountTopPlayers": 1,
    "FifaWorldRank": 24
  },
  {
    "Title": "Korea Republic",
    "AvgMarketValuePerPlayer": 3700000,
    "WinsAgainstTopOpponentSince2014": 1,
    "GamesAgainstTopOpponentSince2014": 3,
    "AmountTopPlayers": 0,
    "FifaWorldRank": 57
  },
  {
    "Title": "Belgium",
    "AvgMarketValuePerPlayer": 33200000,
    "WinsAgainstTopOpponentSince2014": 1,
    "GamesAgainstTopOpponentSince2014": 4,
    "AmountTopPlayers": 9,
    "FifaWorldRank": 3
  },
  {
    "Title": "Panama",
    "AvgMarketValuePerPlayer": 400000,
    "WinsAgainstTopOpponentSince2014": 0,
    "GamesAgainstTopOpponentSince2014": 3,
    "AmountTopPlayers": 0,
    "FifaWorldRank": 55
  },
  {
    "Title": "Tunisia",
    "AvgMarketValuePerPlayer": 2100000,
    "WinsAgainstTopOpponentSince2014": 0,
    "GamesAgainstTopOpponentSince2014": 1,
    "AmountTopPlayers": 0,
    "FifaWorldRank": 21
  },
  {
    "Title": "England",
    "AvgMarketValuePerPlayer": 38000000,
    "WinsAgainstTopOpponentSince2014": 3,
    "GamesAgainstTopOpponentSince2014": 9,
    "AmountTopPlayers": 13,
    "FifaWorldRank": 12
  },
  {
    "Title": "Poland",
    "AvgMarketValuePerPlayer": 11300000,
    "WinsAgainstTopOpponentSince2014": 1,
    "GamesAgainstTopOpponentSince2014": 5,
    "AmountTopPlayers": 2,
    "FifaWorldRank": 8
  },
  {
    "Title": "Senegal",
    "AvgMarketValuePerPlayer": 12400000,
    "WinsAgainstTopOpponentSince2014": 0,
    "GamesAgainstTopOpponentSince2014": 0,
    "AmountTopPlayers": 1,
    "FifaWorldRank": 27
  },
  {
    "Title": "Colombia",
    "AvgMarketValuePerPlayer": 11000000,
    "WinsAgainstTopOpponentSince2014": 2,
    "GamesAgainstTopOpponentSince2014": 12,
    "AmountTopPlayers": 4,
    "FifaWorldRank": 16
  },
  {
    "Title": "Japan",
    "AvgMarketValuePerPlayer": 2700000,
    "WinsAgainstTopOpponentSince2014": 0,
    "GamesAgainstTopOpponentSince2014": 4,
    "AmountTopPlayers": 0,
    "FifaWorldRank": 61
  }
];

function calculateSurpriseFactor(team) {
  let surpriseFactor = false;
  if (team.GamesAgainstTopOpponentSince2014 <= 4) {
    let varianzFifaWorldRank = getVarianzFromFifaWorldRank();
    if (team.FifaWorldRank > varianzFifaWorldRank) {
      surpriseFactor = Math.floor(Math.random() * 2) == 0; //flip a coin
    }
  }
  return surpriseFactor;
}

function calculateAvgWinQuote(team) {
  var avgWinQuote = 0;
  if (team.GamesAgainstTopOpponentSince2014 != 0) {
    avgWinQuote = team.WinsAgainstTopOpponentSince2014 / team.GamesAgainstTopOpponentSince2014;
  }
  return avgWinQuote.toFixed(2);
}

function getVarianzFromFifaWorldRank() {
  let ranks = [];
  let sum = 0;
  let counter = 0;
  for (let index = 0; index < teams.length; index++) {
    const team = teams[index];
    ranks.push(team.FifaWorldRank);
    sum += team.FifaWorldRank;
    counter++;
  }
  ranks.sort((a, b) => a - b);
  let lowMiddle = Math.floor((ranks.length - 1) / 2);
  let highMiddle = Math.ceil((ranks.length - 1) / 2);
  let median = (ranks[lowMiddle] + ranks[highMiddle]) / 2;
  let average = sum / counter;
  let averageQuadraticDeviation = 0;
  for (let i = 0; i < ranks.length; i++) {
    const rank = ranks[i];
    averageQuadraticDeviation += Math.pow(rank - average, 2);
  }
  averageQuadraticDeviation = averageQuadraticDeviation / counter;
  let varianz = Math.sqrt(averageQuadraticDeviation);
  return varianz;
}

/* function forecastResults(games, isTieAllowed) {
  $.each(games, function (i, game) {
    if (null == game.Score1 && null == game.Score2) {
      //Team 1
      var team1AvgWinQuote = calculateAvgWinQuote(game.Team1);
      var team1FifaWorldRank = game.Team1.FifaWorldRank;
      var team1SurpriseFactor = calculateSurpriseFactor(game.Team1);
      var team1AvgPlayersMarketValue = game.Team1.AvgMarketValuePerPlayer;
      //Team 2
      var team2AvgWinQuote = calculateAvgWinQuote(game.Team2);
      var team2FifaWorldRank = game.Team2.FifaWorldRank;
      var team2SurpriseFactor = calculateSurpriseFactor(game.Team2);
      var team2AvgPlayersMarketValue = game.Team2.AvgMarketValuePerPlayer;
      //CALCULATE
      console.log(`${game.Team1.Title} (${team1AvgWinQuote},${team1FifaWorldRank},${team1SurpriseFactor},${team1AvgPlayersMarketValue}) vs ${game.Team2.Title} (${team2AvgWinQuote},${team2FifaWorldRank},${team2SurpriseFactor},${team2AvgPlayersMarketValue})`);
      game.score1 = 1;
      game.score2 = 2;
      if (team1AvgWinQuote > team2AvgWinQuote && team1FifaWorldRank > team2FifaWorldRank && team1AvgPlayersMarketValue > team2AvgPlayersMarketValue) {
        //Clear thing for Team 1
        game.score1 = Math.floor(Math.random() * 2) + 1;
        if (team2SurpriseFactor) {
          var rndm = Math.floor(Math.random() * 2) + 1;
          if (!isTieAllowed && game.score1 == rndm) {
            game.score1 += 1;
          }
          game.score2 = rndm;
        } else {
          game.score2 = 0;
        }
      } else if (team2AvgWinQuote > team1AvgWinQuote && team2FifaWorldRank > team1FifaWorldRank && team2AvgPlayersMarketValue > team1AvgPlayersMarketValue) {
        //Clear thing for Team 2
        game.score2 = Math.floor(Math.random() * 2) + 1;
        if (team1SurpriseFactor) {
          var rndm = Math.floor(Math.random() * 2) + 1;
          if (!isTieAllowed && game.score2 == rndm) {
            game.score2 += 1;
          }
          game.score1 = rndm;
        } else {
          game.score1 = 0;
        }
      } else {
        //Not so clear
        if (team1SurpriseFactor || team2SurpriseFactor) {
          game.score1 = Math.floor(Math.random() * 2) + 1;
          var rndm = Math.floor(Math.random() * 2) + 1;
          if (!isTieAllowed && game.score1 == rndm) {
            game.score1 += 1;
          }
          game.score2 = rndm;
        } else {
          if (team1FifaWorldRank > team2FifaWorldRank) {
            game.score1 = 2;
            game.score2 = 1;
          } else if (team2FifaWorldRank > team1FifaWorldRank) {
            game.score1 = 1;
            game.score2 = 2;
          } else {
            game.score1 = 7;
            game.score2 = 7;
          }
        }
      }
    }
    return;
  });
  return;
} */

function forecastResults(games, isTieAllowed) {
  $.each(games, function (i, game) {
    if (null == game.Score1 && null == game.Score2) {
      //Team 1
      // var team1AvgWinQuote = calculateAvgWinQuote(game.Team1);
      // var team1FifaWorldRank = game.Team1.FifaWorldRank;
      // var team1SurpriseFactor = calculateSurpriseFactor(game.Team1);
      // var team1AvgPlayersMarketValue = game.Team1.AvgMarketValuePerPlayer;
      // //Team 2
      // var team2AvgWinQuote = calculateAvgWinQuote(game.Team2);
      // var team2FifaWorldRank = game.Team2.FifaWorldRank;
      // var team2SurpriseFactor = calculateSurpriseFactor(game.Team2);
      // var team2AvgPlayersMarketValue = game.Team2.AvgMarketValuePerPlayer;
      // //CALCULATE
      // console.log(`${game.Team1.Title} (${team1AvgWinQuote},${team1FifaWorldRank},${team1SurpriseFactor},${team1AvgPlayersMarketValue}) vs ${game.Team2.Title} (${team2AvgWinQuote},${team2FifaWorldRank},${team2SurpriseFactor},${team2AvgPlayersMarketValue})`);
      game.score1 = 1;
      game.score2 = 2;
    }
    return;
  });
  return;
}